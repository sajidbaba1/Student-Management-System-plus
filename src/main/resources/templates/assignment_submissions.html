<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="https://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Assignment Submissions</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background: linear-gradient(135deg, #2c3e50, #3498db); color: #e0e0e0; font-family: 'Arial', sans-serif; }
        .glass { background: rgba(255, 255, 255, 0.08); backdrop-filter: blur(10px); border-radius: 15px; padding: 1.5rem; }
    </style>
</head>
<body>
<div th:replace="~{fragments/navbar :: navbar}"></div>
<div class="container mx-auto mt-8">
    <h1 class="text-3xl text-white mb-4">Assignment Submissions</h1>
    
    <div class="glass mb-6">
        <h2 class="text-xl mb-2" th:text="${assignment.title}"></h2>
        <div class="text-gray-300">
            <span>Course: </span><span th:text="${assignment.course.courseName}"></span>
            <span class="ml-4">Teacher: </span><span th:text="${assignment.teacher.firstName} + ' ' + ${assignment.teacher.lastName}"></span>
            <span class="ml-4">Due: </span><span th:text="${#temporals.format(assignment.dueDate, 'yyyy-MM-dd HH:mm')}"></span>
            <span class="ml-4">Max Score: </span><span th:text="${assignment.maxScore}"></span>
        </div>
    </div>

    <div class="glass">
        <h3 class="text-xl mb-4">Student Submissions</h3>
        <table class="w-full text-left">
            <thead>
            <tr class="text-white border-b border-gray-600">
                <th class="p-3">Student</th>
                <th class="p-3">Submitted At</th>
                <th class="p-3">Status</th>
                <th class="p-3">Score</th>
                <th class="p-3">Feedback</th>
                <th class="p-3">Actions</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="submission : ${submissions}" class="text-gray-200 border-b border-gray-600">
                <td class="p-3" th:text="${submission.student.firstName} + ' ' + ${submission.student.lastName}"></td>
                <td class="p-3">
                    <span th:text="${#temporals.format(submission.submittedAt, 'yyyy-MM-dd HH:mm')}"></span>
                    <span th:if="${submission.late}" class="text-red-400 ml-2">(Late)</span>
                </td>
                <td class="p-3">
                    <span th:if="${submission.graded}" class="text-green-400">Graded</span>
                    <span th:unless="${submission.graded}" class="text-yellow-400">Pending</span>
                </td>
                <td class="p-3">
                    <span th:if="${submission.score != null}" th:text="${submission.score} + '/' + ${assignment.maxScore}"></span>
                    <span th:unless="${submission.score != null}" class="text-gray-400">Not graded</span>
                </td>
                <td class="p-3">
                    <div th:if="${submission.feedback}" th:text="${submission.feedback}" class="max-w-xs truncate"></div>
                    <div th:unless="${submission.feedback}" class="text-gray-400">No feedback</div>
                </td>
                <td class="p-3">
                    <div th:unless="${submission.graded}" sec:authorize="hasAnyRole('ADMIN','STAFF','REGISTRAR','HOD','PRINCIPAL','VICE_PRINCIPAL')">
                        <form th:action="@{/assignments/submissions/{id}/grade(id=${submission.id})}" method="post" class="flex space-x-2">
                            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                            <input type="number" step="0.01" name="score" placeholder="Score" class="bg-gray-800 text-white px-2 py-1 rounded w-20" required />
                            <input type="text" name="feedback" placeholder="Feedback" class="bg-gray-800 text-white px-2 py-1 rounded w-32" />
                            <input type="hidden" name="teacherId" value="1" />
                            <button type="submit" class="bg-blue-600 text-white px-3 py-1 rounded text-sm">Grade</button>
                        </form>
                    </div>
                    <div th:if="${submission.graded}" class="text-green-400">âœ“ Graded</div>
                </td>
            </tr>
            <tr th:if="${submissions.isEmpty()}">
                <td colspan="6" class="p-3 text-center text-gray-300">No submissions yet.</td>
            </tr>
            </tbody>
        </table>
    </div>
</div>
</body>
</html>
