<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="https://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Invoices</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background: linear-gradient(135deg, #2c3e50, #3498db); color: #e0e0e0; font-family: 'Arial', sans-serif; }
        .glass { background: rgba(255, 255, 255, 0.08); backdrop-filter: blur(10px); border-radius: 15px; padding: 1.5rem; }
        table th, table td { padding: .5rem; }
    </style>
</head>
<body>
<div th:replace="~{fragments/navbar :: navbar}"></div>
<div class="container mx-auto mt-8 space-y-4">
    <div class="flex items-center justify-between">
        <h1 class="text-3xl text-white">Invoices</h1>
    </div>

    <div class="glass" sec:authorize="hasAnyRole('ADMIN','STAFF','ACCOUNTANT','PRINCIPAL','VICE_PRINCIPAL')">
        <h2 class="text-xl mb-2">Create Invoice</h2>
        <form th:action="@{/invoices}" method="post" class="grid grid-cols-1 md:grid-cols-4 gap-2">
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
            <input class="bg-gray-800 text-white px-3 py-2 rounded" name="studentId" type="number" placeholder="Student ID" required />
            <input class="bg-gray-800 text-white px-3 py-2 rounded" name="description" type="text" placeholder="Description" required />
            <input class="bg-gray-800 text-white px-3 py-2 rounded" name="amount" type="number" step="0.01" placeholder="Amount" required />
            <input class="bg-gray-800 text-white px-3 py-2 rounded" name="dueDate" type="date" required />
            <div class="md:col-span-4">
                <button class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700" type="submit">Create</button>
            </div>
        </form>
    </div>

    <div class="glass">
        <table class="w-full text-left">
            <thead>
            <tr class="text-white border-b border-gray-600">
                <th>ID</th>
                <th>Student</th>
                <th>Description</th>
                <th>Amount</th>
                <th>Due</th>
                <th>Status</th>
                <th>Actions</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="inv : ${invoices}" class="text-gray-200 border-b border-gray-600">
                <td th:text="${inv.id}"></td>
                <td th:text="${inv.student.firstName} + ' ' + ${inv.student.lastName}"></td>
                <td th:text="${inv.description}"></td>
                <td th:text="${inv.amount}"></td>
                <td th:text="${inv.dueDate}"></td>
                <td th:text="${inv.status}"></td>
                <td>
                    <a th:href="@{'/invoices/' + ${inv.id}}" class="text-blue-400 hover:underline">View</a>
                </td>
            </tr>
            <tr th:if="${invoices.isEmpty()}">
                <td colspan="7" class="text-center text-gray-300 p-3">No invoices yet</td>
            </tr>
            </tbody>
        </table>
    </div>
</div>
</body>
</html>
